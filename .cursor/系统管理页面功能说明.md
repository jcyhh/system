# 系统管理页面功能说明

## 功能概述
系统管理页面（`pages/mine/system.vue`）用于管理员控制平台排队开关。

## 访问路径
**我的** → **系统管理**（仅管理员可见）

## 功能详情

### 1. 平台排队开关
管理员可以通过开关控制整个平台的排队功能：

- **开启状态**：用户可以正常提交排队申请
- **关闭状态**：用户无法提交新的排队申请（已在排队中的任务不受影响）

### 2. 权限控制
- 只有管理员（`role === 1`）可以访问此页面
- 非管理员访问会提示"权限不足"并自动返回

### 3. 实时生效
- 管理员修改开关后立即生效
- 用户在提交排队申请时会实时检测开关状态

## 技术实现

### 数据库配置
在 `system_info` 表中需要有以下配置：

```json
{
  "key": "queue_switch",
  "title": "排队开关",
  "content": "true",
  "is_published": true
}
```

### 前端实现

#### 系统管理页面（system.vue）
- 查询 `system_info` 表获取开关状态
- 使用 `switch` 组件展示和控制开关
- 修改时更新数据库中的 `content` 字段
- 权限验证：进入页面时检查管理员身份

#### 排队申请页面（apply.vue）
- 添加 `checkQueueSwitch()` 方法检测开关状态
- 在提交表单前（`submit` 方法中）调用检测
- 如果开关关闭，提示用户并阻止提交
- 编辑模式（修改已有申请）不检查开关

#### 我的页面（mine.vue）
- 管理员可见"系统管理"入口按钮
- 点击跳转到系统管理页面

## 使用场景

### 场景1：系统维护
当需要进行系统维护时，管理员可以：
1. 进入系统管理页面
2. 关闭排队开关
3. 完成维护后重新开启

### 场景2：特殊情况
在节假日、设备故障等特殊情况下，可以临时关闭排队功能。

### 场景3：流量控制
当排队人数过多时，可以临时关闭新申请，优先处理现有队列。

## 注意事项

1. **关闭排队不影响现有任务**
   - 已在排队中的任务继续正常处理
   - 用户可以查看和编辑自己的排队记录
   - 只是阻止新的排队申请提交

2. **立即生效**
   - 开关修改后无需重启应用
   - 用户下次提交时即可感知到变化

3. **默认值**
   - 如果数据库中没有配置，默认允许排队
   - 查询出错时也默认允许排队，确保系统可用性

4. **编辑不受限制**
   - 用户编辑自己已有的排队申请时不受开关限制
   - 只有新提交时才会检查开关状态

## 界面说明

### 系统管理页面布局
```
┌─────────────────────────────┐
│    平台排队开关             │
│    关闭后用户将无法提交...  │
├─────────────────────────────┤
│  排队功能      已开启  [开关]│
├─────────────────────────────┤
│  提示信息：                 │
│  • 关闭排队功能后...        │
│  • 已经在排队中的...        │
│  • 建议在系统维护...        │
└─────────────────────────────┘
```

## 错误处理

1. **配置不存在**
   - 提示管理员添加 `queue_switch` 配置
   
2. **权限不足**
   - 非管理员访问时提示并返回
   
3. **网络错误**
   - 显示"加载失败"或"保存失败"
   - 不影响现有状态

## 后续扩展建议

可以在系统管理页面添加更多功能：
- 公告管理（已有独立页面）
- 平台数据统计
- 系统参数配置
- 操作日志查看
