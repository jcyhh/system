# 公告管理 - 页面模式说明

## 📝 更新内容

已将公告的新增和编辑功能从弹窗模式改为独立页面模式。

---

## 🎯 页面结构

### 1. 公告列表页（`pages/notice/list.vue`）

**功能**:
- 显示所有公告列表
- 管理员可见：添加按钮、编辑图标、删除图标、状态标签
- 普通用户：仅显示已发布的公告

**操作**:
- 点击"添加公告" → 跳转到编辑页（新增模式）
- 点击编辑图标 → 跳转到编辑页（编辑模式）
- 点击删除图标 → 弹出确认对话框删除

---

### 2. 公告编辑页（`pages/notice/edit.vue`）

**功能**:
- 新增公告：`/pages/notice/edit`
- 编辑公告：`/pages/notice/edit?id=xxx`

**表单字段**:
- 公告标题（必填）
- 公告内容（必填，支持 HTML）
- 是否发布（开关，默认开启）
- 是否弹窗展示（开关，默认关闭）

**提交逻辑**:
1. 验证标题和内容不为空
2. 调用云函数创建或更新
3. 成功后显示提示
4. 1.5秒后自动返回列表页
5. 列表页自动刷新

---

## 🔄 页面交互流程

### 新增公告流程

```
公告列表页
    ↓ 点击"添加公告"
编辑页（新增模式）
    ↓ 填写表单
    ↓ 点击"创建公告"
    ↓ 提交成功
    ↓ 显示"创建成功"
    ↓ 1.5秒后自动返回
公告列表页（自动刷新）
```

### 编辑公告流程

```
公告列表页
    ↓ 点击编辑图标
编辑页（编辑模式）
    ↓ 自动加载原有数据
    ↓ 修改表单
    ↓ 点击"保存修改"
    ↓ 提交成功
    ↓ 显示"保存成功"
    ↓ 1.5秒后自动返回
公告列表页（自动刷新）
```

---

## 💻 技术实现

### 1. 路由配置（`pages.json`）

```json
{
  "path": "pages/notice/edit",
  "style": {
    "navigationBarTitleText": "公告"
  }
}
```

**说明**: 标题会在页面加载时动态设置为"添加公告"或"编辑公告"。

---

### 2. 模式判断（`pages/notice/edit.vue`）

```typescript
onLoad((options) => {
  if (options?.id) {
    // 编辑模式
    isEdit.value = true
    noticeId.value = options.id
    loadNoticeDetail(options.id)
    uni.setNavigationBarTitle({ title: '编辑公告' })
  } else {
    // 新增模式
    uni.setNavigationBarTitle({ title: '添加公告' })
  }
})
```

**说明**:
- URL 带 `id` 参数 → 编辑模式
- URL 不带参数 → 新增模式

---

### 3. 列表页刷新（`pages/notice/list.vue`）

```typescript
onShow(() => {
  // 不是首次加载时才刷新
  if (noticeList.value.length > 0) {
    loadNoticeList(true)
  }
})
```

**说明**:
- 页面显示时检查列表是否有数据
- 有数据说明不是首次加载，执行刷新
- 避免首次加载重复请求

---

## 🎨 界面展示

### 编辑页面布局

```
┌─────────────────────────────────────┐
│  < 添加公告 / 编辑公告                 │
├─────────────────────────────────────┤
│                                       │
│  公告标题                              │
│  ┌───────────────────────────────┐  │
│  │                               │  │
│  └───────────────────────────────┘  │
│                                       │
│  公告内容                              │
│  ┌───────────────────────────────┐  │
│  │                               │  │
│  │                               │  │
│  │                               │  │
│  │                               │  │
│  └───────────────────────────────┘  │
│                                       │
│  是否发布              ○————●        │
│  ────────────────────────────────   │
│  是否弹窗展示          ●————○        │
│                                       │
│                                       │
│  ┌─────────────────────────────┐    │
│  │    创建公告 / 保存修改       │    │
│  └─────────────────────────────┘    │
│                                       │
└─────────────────────────────────────┘
```

---

## ✨ 优势对比

### 弹窗模式 vs 页面模式

| 特性 | 弹窗模式 | 页面模式 ✅ |
|------|---------|------------|
| 内容展示 | 受弹窗大小限制 | 全屏显示，空间充足 |
| 输入体验 | 输入框较小 | 输入框更大，体验更好 |
| 导航体验 | 无导航栏 | 有返回按钮，更符合习惯 |
| 数据持久 | 关闭即丢失 | 可返回修改（如果不清空） |
| 键盘遮挡 | 容易遮挡内容 | 系统自动处理滚动 |
| 长内容编辑 | 不便操作 | 滚动流畅 |

---

## 📱 使用说明

### 管理员操作

#### 添加公告
1. 进入公告列表页
2. 点击底部"添加公告"按钮
3. 填写标题和内容
4. 根据需要开启"是否发布"和"是否弹窗展示"
5. 点击"创建公告"按钮
6. 等待提示"创建成功"
7. 自动返回列表页，查看新建的公告

#### 编辑公告
1. 在列表中找到要编辑的公告
2. 点击右侧的编辑图标（笔形）
3. 修改标题、内容或状态
4. 点击"保存修改"按钮
5. 等待提示"保存成功"
6. 自动返回列表页，查看修改后的公告

---

## 🔧 注意事项

### 1. 权限控制

- ✅ 只有管理员可以访问编辑页
- ✅ 云函数会验证管理员权限
- ❌ 非管理员无法通过 URL 直接访问编辑页

### 2. 数据验证

- 标题和内容必填
- 提交前会验证，为空会提示
- 内容支持 HTML 格式，可以输入富文本

### 3. 提交反馈

- 提交中显示 loading
- 成功显示 toast 提示
- 失败显示错误信息
- 成功后 1.5 秒自动返回

### 4. 列表刷新

- 返回列表页会自动刷新
- 使用 `onShow` 监听页面显示
- 避免首次加载重复请求

---

## 🚀 部署说明

### 无需额外部署

这次修改只涉及前端页面，无需更新云函数：
- ✅ `pages/notice/list.vue` - 已更新
- ✅ `pages/notice/edit.vue` - 已创建
- ✅ `pages.json` - 已有配置
- ✅ 云函数 - 无需修改

### 测试步骤

1. 编译运行小程序
2. 使用管理员账号登录
3. 进入公告列表页
4. 测试添加公告功能
5. 测试编辑公告功能
6. 验证返回后列表自动刷新

---

## ✅ 总结

**改进内容**:
- ✅ 从弹窗改为独立页面
- ✅ 更好的输入体验
- ✅ 更大的内容展示空间
- ✅ 符合小程序交互习惯
- ✅ 自动刷新列表

**用户体验**:
- ✅ 导航更清晰（有返回按钮）
- ✅ 输入更方便（全屏输入）
- ✅ 操作更流畅（自动返回刷新）
- ✅ 符合习惯（页面跳转模式）
