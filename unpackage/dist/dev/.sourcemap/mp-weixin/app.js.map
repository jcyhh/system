{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\r\n\timport { useAppStore } from '@/store'\r\n\t\r\n\texport default {\r\n\t\tonLaunch: function() {\r\n\t\t\tconsole.log('App Launch')\r\n\t\t\t\r\n\t\t\t// 恢复登录状态\r\n\t\t\tconst appStore = useAppStore()\r\n\t\t\tappStore.restoreLoginState()\r\n\t\t\t\r\n\t\t\t// 验证token是否有效\r\n\t\t\tthis.checkToken()\r\n\t\t},\r\n\t\tonShow: function() {\r\n\t\t\tconsole.log('App Show')\r\n\t\t},\r\n\t\tonHide: function() {\r\n\t\t\tconsole.log('App Hide')\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tasync checkToken() {\r\n\t\t\t\tconst appStore = useAppStore()\r\n\t\t\t\t\r\n\t\t\t\tif (!appStore.token) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst userObj = uniCloud.importObject('user')\r\n\t\t\t\t\tconst res = await userObj.getUserInfo()\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (res.errCode === 0) {\r\n\t\t\t\t\t\t// token有效，更新用户信息和角色\r\n\t\t\t\t\t\tappStore.setLoginInfo(res.data, appStore.token)\r\n\t\t\t\t\t\tconsole.log('登录状态有效，角色：', res.data.role === 1 ? '管理员' : '普通用户')\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// token无效，清除登录信息\r\n\t\t\t\t\t\tappStore.clearLoginInfo()\r\n\t\t\t\t\t\tconsole.log('登录已过期')\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('验证登录状态失败', e)\r\n\t\t\t\t\tappStore.clearLoginInfo()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n@import '@/styles/index.scss';\r\npage{\r\n\tbackground-color: #F7F7F7;\r\n}\r\n</style>\r\n","import App from './App'\r\n\r\n// #ifndef VUE3\r\nimport Vue from 'vue'\r\nimport './uni.promisify.adaptor'\r\nVue.config.productionTip = false\r\nApp.mpType = 'app'\r\nconst app = new Vue({\r\n\t...App\r\n})\r\napp.$mount()\r\n// #endif\r\n\r\n// #ifdef VUE3\r\nimport {\r\n\tcreateSSRApp\r\n} from 'vue'\r\nimport {\r\n\tsetupStore\r\n} from '@/store'\r\nexport function createApp() {\r\n\tconst app = createSSRApp(App)\r\n\r\n\t/**\r\n\t * pinia\r\n\t */\r\n\tsetupStore(app)\r\n\r\n\treturn {\r\n\t\tapp\r\n\t}\r\n}\r\n// #endif"],"names":["uni","useAppStore","uniCloud","createSSRApp","App","setupStore"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAGC,MAAK,YAAU;AAAA,EACd,UAAU,WAAW;AACpBA,kBAAAA,MAAA,MAAA,OAAA,gBAAY,YAAY;AAGxB,UAAM,WAAWC,kBAAAA,YAAY;AAC7B,aAAS,kBAAkB;AAG3B,SAAK,WAAW;AAAA,EAChB;AAAA,EACD,QAAQ,WAAW;AAClBD,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,QAAQ,WAAW;AAClBA,kBAAAA,MAAY,MAAA,OAAA,iBAAA,UAAU;AAAA,EACtB;AAAA,EACD,SAAS;AAAA,IACR,MAAM,aAAa;AAClB,YAAM,WAAWC,kBAAAA,YAAY;AAE7B,UAAI,CAAC,SAAS,OAAO;AACpB;AAAA,MACD;AAEA,UAAI;AACH,cAAM,UAAUC,cAAAA,GAAS,aAAa,MAAM;AAC5C,cAAM,MAAM,MAAM,QAAQ,YAAY;AAEtC,YAAI,IAAI,YAAY,GAAG;AAEtB,mBAAS,aAAa,IAAI,MAAM,SAAS,KAAK;AAC9CF,wBAAAA,MAAY,MAAA,OAAA,iBAAA,cAAc,IAAI,KAAK,SAAS,IAAI,QAAQ,MAAM;AAAA,eACxD;AAEN,mBAAS,eAAe;AACxBA,wBAAAA,MAAY,MAAA,OAAA,iBAAA,OAAO;AAAA,QACpB;AAAA,MACD,SAAS,GAAG;AACXA,sBAAAA,MAAc,MAAA,SAAA,iBAAA,YAAY,CAAC;AAC3B,iBAAS,eAAe;AAAA,MACzB;AAAA,IACD;AAAA,EACD;AACD;AC3BM,SAAS,YAAY;AAC3B,QAAM,MAAMG,cAAY,aAACC,SAAG;AAK5BC,cAAAA,WAAW,GAAG;AAEd,SAAO;AAAA,IACN;AAAA,EACA;AACF;;;"}