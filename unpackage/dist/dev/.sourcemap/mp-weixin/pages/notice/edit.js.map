{"version":3,"file":"edit.js","sources":["pages/notice/edit.vue","pages/notice/edit.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"pl30 pr30 pt30\">\n\t\t<view class=\"size28 mb10\">公告标题</view>\n\t\t<input class=\"input mb30\" v-model=\"formData.title\" placeholder=\"请输入公告标题\" />\n\t\t\n\t\t<view class=\"size28 mb10\">公告内容</view>\n\t\t<textarea \n\t\t\tclass=\"textarea mb30\" \n\t\t\tv-model=\"formData.content\" \n\t\t\tplaceholder=\"请输入公告内容，支持HTML格式\" \n\t\t\t:auto-height=\"true\"\n\t\t\t:maxlength=\"-1\"\n\t\t/>\n\t\t\n\t\t<view class=\"setting-item flex jb ac mb20\">\n\t\t\t<view class=\"size28\">是否发布</view>\n\t\t\t<switch :checked=\"formData.is_published\" @change=\"onPublishChange\" />\n\t\t</view>\n\t\t\n\t\t<view class=\"setting-item flex jb ac mb30\">\n\t\t\t<view class=\"size28\">是否弹窗展示</view>\n\t\t\t<switch :checked=\"formData.is_popup\" @change=\"onPopupChange\" />\n\t\t</view>\n\t\t\n\t\t<view class=\"btn flex jc ac\" @click=\"submitForm\">\n\t\t\t{{ isEdit ? '保存修改' : '创建公告' }}\n\t\t</view>\n\t</view>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\n\nconst isEdit = ref(false)\nconst noticeId = ref('')\n\nconst formData = ref({\n\ttitle: '',\n\tcontent: '',\n\tis_published: true,\n\tis_popup: false\n})\n\n// 开关切换\nconst onPublishChange = (e: any) => {\n\tformData.value.is_published = e.detail.value\n}\n\nconst onPopupChange = (e: any) => {\n\tformData.value.is_popup = e.detail.value\n}\n\n// 加载公告详情（编辑时）\nconst loadNoticeDetail = async (id: string) => {\n\ttry {\n\t\tconst noticeObj = uniCloud.importObject('notice')\n\t\tconst res = await noticeObj.getDetail({ id })\n\t\t\n\t\tif (res.errCode === 0) {\n\t\t\tformData.value = {\n\t\t\t\ttitle: res.data.title,\n\t\t\t\tcontent: res.data.content,\n\t\t\t\tis_published: res.data.is_published,\n\t\t\t\tis_popup: res.data.is_popup || false\n\t\t\t}\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: res.errMsg || '获取失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t} catch (e: any) {\n\t\tuni.__f__('error','at pages/notice/edit.vue:74','获取公告详情失败：', e)\n\t\tuni.showToast({\n\t\t\ttitle: e.message || '获取失败',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\n\n// 提交表单\nconst submitForm = async () => {\n\t// 验证\n\tif (!formData.value.title.trim()) {\n\t\tuni.showToast({\n\t\t\ttitle: '请输入公告标题',\n\t\t\ticon: 'none'\n\t\t})\n\t\treturn\n\t}\n\t\n\tif (!formData.value.content.trim()) {\n\t\tuni.showToast({\n\t\t\ttitle: '请输入公告内容',\n\t\t\ticon: 'none'\n\t\t})\n\t\treturn\n\t}\n\t\n\ttry {\n\t\tuni.showLoading({\n\t\t\ttitle: isEdit.value ? '保存中...' : '创建中...'\n\t\t})\n\t\t\n\t\tconst noticeObj = uniCloud.importObject('notice')\n\t\tlet result\n\t\t\n\t\tif (isEdit.value) {\n\t\t\t// 编辑\n\t\t\tresult = await noticeObj.update({\n\t\t\t\tid: noticeId.value,\n\t\t\t\ttitle: formData.value.title.trim(),\n\t\t\t\tcontent: formData.value.content.trim(),\n\t\t\t\tis_published: formData.value.is_published,\n\t\t\t\tis_popup: formData.value.is_popup\n\t\t\t})\n\t\t} else {\n\t\t\t// 新增\n\t\t\tresult = await noticeObj.create({\n\t\t\t\ttitle: formData.value.title.trim(),\n\t\t\t\tcontent: formData.value.content.trim(),\n\t\t\t\tis_published: formData.value.is_published,\n\t\t\t\tis_popup: formData.value.is_popup\n\t\t\t})\n\t\t}\n\t\t\n\t\tuni.hideLoading()\n\t\t\n\t\tif (result.errCode === 0) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: isEdit.value ? '保存成功' : '创建成功',\n\t\t\t\ticon: 'success',\n\t\t\t\tduration: 1500\n\t\t\t})\n\t\t\t\n\t\t\t// 延迟返回，让用户看到提示\n\t\t\tsetTimeout(() => {\n\t\t\t\tuni.navigateBack({\n\t\t\t\t\tdelta: 1\n\t\t\t\t})\n\t\t\t}, 1500)\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: result.errMsg || '操作失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t} catch (e: any) {\n\t\tuni.hideLoading()\n\t\tuni.__f__('error','at pages/notice/edit.vue:151','操作失败：', e)\n\t\tuni.showToast({\n\t\t\ttitle: e.message || '操作失败',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\n\nonLoad((options) => {\n\tif (options?.id) {\n\t\t// 编辑模式\n\t\tisEdit.value = true\n\t\tnoticeId.value = options.id\n\t\tloadNoticeDetail(options.id)\n\t\t\n\t\tuni.setNavigationBarTitle({\n\t\t\ttitle: '编辑公告'\n\t\t})\n\t} else {\n\t\t// 新增模式\n\t\tuni.setNavigationBarTitle({\n\t\t\ttitle: '添加公告'\n\t\t})\n\t}\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.input {\n\twidth: 100%;\n\theight: 80rpx;\n\tborder: 1px solid #E5E5E5;\n\tborder-radius: 10rpx;\n\tpadding: 0 20rpx;\n\tbox-sizing: border-box;\n\tfont-size: 28rpx;\n\tbackground-color: #FFFFFF;\n}\n\n.textarea {\n\twidth: 100%;\n\tmin-height: 400rpx;\n\tborder: 1px solid #E5E5E5;\n\tborder-radius: 10rpx;\n\tpadding: 20rpx;\n\tbox-sizing: border-box;\n\tfont-size: 28rpx;\n\tline-height: 1.6;\n\tbackground-color: #FFFFFF;\n}\n\n.setting-item {\n\tpadding: 20rpx 0;\n\tborder-bottom: 1px solid #F5F5F5;\n}\n\n.btn {\n\twidth: 100%;\n\theight: 88rpx;\n\tborder-radius: 44rpx;\n\tbackground-color: $main-color;\n\tcolor: #FFFFFF;\n\tfont-size: 32rpx;\n\tmargin-top: 60rpx;\n}\n</style>","import MiniProgramPage from '/Users/jcy/code/wx/system/pages/notice/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uniCloud","uni","onLoad"],"mappings":"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"}