{"version":3,"file":"mine.js","sources":["pages/tabbar/mine.vue","pages/tabbar/mine.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"bg\"></view>\n\t\n\t<view class=\"rel pl30 pr30\">\n\t\t\n\t\t<view class=\"gap150\"></view>\n\t\t\n\t\t<view class=\"flex ac mb60\" @click=\"handleLogin\">\n\t\t\t<image src=\"/static/imgs/avatar.png\" mode=\"aspectFill\" class=\"avatar\"></image>\n\t\t\t<view class=\"ml20\">\n\t\t\t\t<view class=\"size35 bold white\">{{ isLogin ? (role === 1 ? '管理员' : '用户') : '点击登录' }}</view>\n\t\t\t\t<view v-if=\"isLogin\" class=\"size24 white mt5 flex ac\" style=\"opacity: 0.8;\" @click.stop=\"copy\">\n\t\t\t\t\tID：{{ userId.slice(0, 8) }}...\n\t\t\t\t\t<image src=\"/static/imgs/copy.png\" class=\"img30 ml10\"></image>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"card mb30\" v-if=\"role==1\">\n\t\t\t<view class=\"size28 bold\">登记查询</view>\n\t\t\t<view class=\"mt30 flex\">\n\t\t\t\t<view class=\"tc flex1\" @click=\"goLog(0)\">\n\t\t\t\t\t<image src=\"/static/imgs/7.png\" class=\"img48\"></image>\n\t\t\t\t\t<view class=\"size26 mt10 grey\">处理中</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tc flex1\" @click=\"goLog(1)\">\n\t\t\t\t\t<image src=\"/static/imgs/8.png\" class=\"img48\"></image>\n\t\t\t\t\t<view class=\"size26 mt10 grey\">排队中</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tc flex1\" @click=\"goLog(2)\">\n\t\t\t\t\t<image src=\"/static/imgs/9.png\" class=\"img48\"></image>\n\t\t\t\t\t<view class=\"size26 mt10 grey\">已完成</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"card\">\n\t\t\t<view class=\"size28 bold mb20\">常用功能</view>\n\t\t\t<button open-type=\"contact\" class=\"btn\">\n\t\t\t\t<view class=\"flex jb ac pt30 pb30\">\n\t\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t\t<image src=\"/static/imgs/11.png\" class=\"img38\"></image>\n\t\t\t\t\t\t<view class=\"size28 ml20\">联系客服</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<uni-icons type=\"right\" color=\"#999999\" :size=\"20\"></uni-icons>\n\t\t\t\t</view>\n\t\t\t</button>\n\t\t\t\n\t\t\t<view class=\"flex jb ac pt30 pb20\" @click=\"gorule\">\n\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t<image src=\"/static/imgs/12.png\" class=\"img38\"></image>\n\t\t\t\t\t<view class=\"size28 ml20\">操作指引</view>\n\t\t\t\t</view>\n\t\t\t\t<uni-icons type=\"right\" color=\"#999999\" :size=\"20\"></uni-icons>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n\t\n</template>\n\n<script lang=\"ts\" setup>\nimport { useAppStore } from '@/store';\nimport { storeToRefs } from 'pinia'\n\nconst appStore = useAppStore()\nconst { role, isLogin, userId } = storeToRefs(appStore)\n\n// 处理登录\nconst handleLogin = async () => {\n\tif (isLogin.value) {\n\t\t// 已登录，不做任何操作\n\t\treturn\n\t}\n\t\n\t// 未登录，执行微信登录\n\ttry {\n\t\t// 获取微信登录code\n\t\tconst loginRes = await uni.login({\n\t\t\tprovider: 'weixin'\n\t\t})\n\t\t\n\t\tif (!loginRes.code) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '获取登录信息失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t\t\n\t\tuni.showLoading({\n\t\t\ttitle: '登录中...'\n\t\t})\n\t\t\n\t\t// 调用云对象登录\n\t\tconst userObj = uniCloud.importObject('user')\n\t\tconst res = await userObj.loginByWeixin({\n\t\t\tcode: loginRes.code\n\t\t})\n\t\t\n\t\tuni.hideLoading()\n\t\t\n\t\tif (res.errCode === 0) {\n\t\t\t// 保存登录信息和角色\n\t\t\tappStore.setLoginInfo(res.data.userInfo, res.data.token)\n\t\t\t\n\t\t\tconst roleName = res.data.userInfo.role === 1 ? '管理员' : '普通用户'\n\t\t\tuni.showToast({\n\t\t\t\ttitle: `登录成功 (${roleName})`,\n\t\t\t\ticon: 'success'\n\t\t\t})\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: res.errMsg || '登录失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t} catch (e: any) {\n\t\tuni.hideLoading()\n\t\tuni.__f__('error','at pages/tabbar/mine.vue:119','登录失败', e)\n\t\tuni.showToast({\n\t\t\ttitle: '登录失败，请重试',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\n\nconst goLog = (type:number) => {\n\tif(type==0){\n\t\tuni.navigateTo({\n\t\t\turl: \"/pages/mine/dealing\"\n\t\t})\n\t}else if(type==1){\n\t\tuni.navigateTo({\n\t\t\turl: \"/pages/mine/waiting\"\n\t\t})\n\t}else{\n\t\tuni.navigateTo({\n\t\t\turl:\"/pages/mine/finished\"\n\t\t})\n\t}\n}\n\nconst gorule = () => {\n\tuni.navigateTo({\n\t\turl:\"/pages/mine/rule\"\n\t})\n}\n\nconst copy = () => {\n\tuni.setClipboardData({\n\t\tdata:userId.value\n\t})\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.bg{\n\twidth: 100vw;\n\theight: 750rpx;\n\tbackground: linear-gradient(#29156a, #F7F7F7);\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n}\n.avatar{\n\twidth: 100rpx;\n\theight: 100rpx;\n\tborder-radius: 50%;\n\tborder: 2rpx solid #FFFFFF;\n}\n.btn{\n\tpadding: 0;\n\tmargin: 0;\n\tborder: none;\n\tbackground-color: transparent;\n}\n.btn::after{\n\tdisplay: none;\n}\n</style>","import MiniProgramPage from '/Users/jcy/code/wx/system/pages/tabbar/mine.vue'\nwx.createPage(MiniProgramPage)"],"names":["useAppStore","storeToRefs","uni","uniCloud"],"mappings":";;;;;;;;;;;;;;;;AAgEA,UAAM,WAAWA,kBAAAA;AACjB,UAAM,EAAE,MAAM,SAAS,OAAO,IAAIC,cAAAA,YAAY,QAAQ;AAGtD,UAAM,cAAc,YAAY;AAC/B,UAAI,QAAQ,OAAO;AAElB;AAAA,MACD;AAGI,UAAA;AAEG,cAAA,WAAW,MAAMC,cAAA,MAAI,MAAM;AAAA,UAChC,UAAU;AAAA,QAAA,CACV;AAEG,YAAA,CAAC,SAAS,MAAM;AACnBA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,UAAA,CACN;AACD;AAAA,QACD;AAEAA,sBAAAA,MAAI,YAAY;AAAA,UACf,OAAO;AAAA,QAAA,CACP;AAGK,cAAA,UAAUC,cAAAA,GAAS,aAAa,MAAM;AACtC,cAAA,MAAM,MAAM,QAAQ,cAAc;AAAA,UACvC,MAAM,SAAS;AAAA,QAAA,CACf;AAEDD,sBAAA,MAAI,YAAY;AAEZ,YAAA,IAAI,YAAY,GAAG;AAEtB,mBAAS,aAAa,IAAI,KAAK,UAAU,IAAI,KAAK,KAAK;AAEvD,gBAAM,WAAW,IAAI,KAAK,SAAS,SAAS,IAAI,QAAQ;AACxDA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,SAAS,QAAQ;AAAA,YACxB,MAAM;AAAA,UAAA,CACN;AAAA,QAAA,OACK;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI,UAAU;AAAA,YACrB,MAAM;AAAA,UAAA,CACN;AAAA,QACF;AAAA,eACQ,GAAQ;AAChBA,sBAAA,MAAI,YAAY;AAChBA,sBAAA,MAAI,MAAM,SAAQ,gCAA+B,QAAQ,CAAC;AAC1DA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,MACF;AAAA,IAAA;AAGK,UAAA,QAAQ,CAAC,SAAgB;AAC9B,UAAG,QAAM,GAAE;AACVA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK;AAAA,QAAA,CACL;AAAA,MAAA,WACO,QAAM,GAAE;AAChBA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK;AAAA,QAAA,CACL;AAAA,MAAA,OACG;AACJA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAI;AAAA,QAAA,CACJ;AAAA,MACF;AAAA,IAAA;AAGD,UAAM,SAAS,MAAM;AACpBA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAI;AAAA,MAAA,CACJ;AAAA,IAAA;AAGF,UAAM,OAAO,MAAM;AAClBA,oBAAAA,MAAI,iBAAiB;AAAA,QACpB,MAAK,OAAO;AAAA,MAAA,CACZ;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtJF,GAAG,WAAW,eAAe;"}