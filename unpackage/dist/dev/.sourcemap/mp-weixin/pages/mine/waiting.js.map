{"version":3,"file":"waiting.js","sources":["pages/mine/waiting.vue","pages/mine/waiting.vue?type=page"],"sourcesContent":["<template>\n\t\n\t<view class=\"pl30 pr30 mt30\">\n\t\t\n\t\t<view class=\"card mb20\" v-for=\"(item,index) in waitingList\" :key=\"item._id\" @click=\"goDetail(item)\">\n\t\t\t<view class=\"flex jb ac\">\n\t\t\t\t<view class=\"no flex jc ac size28 mr20\">#{{ index + 1 }}</view>\n\t\t\t\t<view class=\"flex1\">\n\t\t\t\t\t<view class=\"flex jb ac size30\">\n\t\t\t\t\t\t<view>{{ item.driver_name }}</view>\n\t\t\t\t\t\t<view class=\"bold\">{{ item.plate_number }}</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"size26 mt10 grey\">{{ item.phone }}</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"line mt30 mb30\"></view>\n\t\t\t<view class=\"flex jb ac\">\n\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t<view class=\"size28 bold mr20\">{{ item.truck_type }}</view>\n\t\t\t\t\t<image :src=\"item.operation_type == 1 ? '/static/imgs/5.png' : '/static/imgs/6.png'\" class=\"img40 mr10\"></image>\n\t\t\t\t\t<view class=\"size26 grey\">{{ item.operation_type == 1 ? '卸车' : '装车' }}</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"size26 gray\">{{ formatTime(item.create_time) }}</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"tc mt60 size28 gray\" v-if=\"waitingList.length === 0 && !isLoading\">\n\t\t\t<view class=\"flex jc\">\n\t\t\t\t<image src=\"@/static/imgs/nodata.png\" class=\"img200\"></image>\n\t\t\t</view>\n\t\t\t暂无排队中的单子\n\t\t</view>\n\t\t\n\t\t<!-- 加载状态 -->\n\t\t<view class=\"tc size28 gray mt30 mb30\" v-if=\"isLoading\">\n\t\t\t加载中...\n\t\t</view>\n\t\t<view class=\"tc size28 gray mt30 mb30\" v-else-if=\"!hasMore && waitingList.length > 0\">\n\t\t\t没有更多了\n\t\t</view>\n\t\t\n\t</view>\n\t\n\t<view class=\"gap50\"></view>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref } from 'vue';\nimport { onLoad, onPullDownRefresh, onReachBottom } from '@dcloudio/uni-app';\n\nconst waitingList = ref<any[]>([])\nconst page = ref(1)\nconst pageSize = 20\nconst hasMore = ref(true)\nconst isLoading = ref(false)\n\n// 加载排队中的单子\nconst loadWaitingList = async (isRefresh = false) => {\n\tif (isLoading.value) return\n\tif (!hasMore.value && !isRefresh) return\n\t\n\ttry {\n\t\tisLoading.value = true\n\t\t\n\t\t// 如果是刷新，重置页码\n\t\tif (isRefresh) {\n\t\t\tpage.value = 1\n\t\t\thasMore.value = true\n\t\t}\n\t\t\n\t\tconst truckObj = uniCloud.importObject('truck')\n\t\tconst res = await truckObj.getList({\n\t\t\tstatus: 0,  // 排队中\n\t\t\tpage: page.value,\n\t\t\tpageSize: pageSize\n\t\t})\n\t\t\n\t\tif (res.errCode === 0) {\n\t\t\tif (isRefresh) {\n\t\t\t\twaitingList.value = res.data.list\n\t\t\t} else {\n\t\t\t\twaitingList.value = [...waitingList.value, ...res.data.list]\n\t\t\t}\n\t\t\t\n\t\t\t// 判断是否还有更多数据\n\t\t\tif (res.data.list.length < pageSize) {\n\t\t\t\thasMore.value = false\n\t\t\t}\n\t\t\t\n\t\t\t// 加载成功，页码+1\n\t\t\tif (res.data.list.length > 0) {\n\t\t\t\tpage.value++\n\t\t\t}\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: res.errMsg || '获取失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t} catch (e: any) {\n\t\tuni.__f__('error','at pages/mine/waiting.vue:101','获取失败：', e)\n\t\tuni.showToast({\n\t\t\ttitle: e.message || '获取失败',\n\t\t\ticon: 'none'\n\t\t})\n\t} finally {\n\t\tisLoading.value = false\n\t}\n}\n\n// 格式化时间\nconst formatTime = (timestamp: number) => {\n\tconst date = new Date(timestamp)\n\tconst month = String(date.getMonth() + 1).padStart(2, '0')\n\tconst day = String(date.getDate()).padStart(2, '0')\n\tconst hour = String(date.getHours()).padStart(2, '0')\n\tconst minute = String(date.getMinutes()).padStart(2, '0')\n\treturn `${month}-${day} ${hour}:${minute}`\n}\n\n// 跳转到详情页\nconst goDetail = (item: any) => {\n\tuni.navigateTo({\n\t\turl: `/pages/mine/detail?id=${item._id}`\n\t})\n}\n\n// 页面加载\nonLoad(() => {\n\tloadWaitingList(true)\n})\n\n// 下拉刷新\nonPullDownRefresh(async () => {\n\ttry {\n\t\tawait loadWaitingList(true)\n\t\tuni.showToast({\n\t\t\ttitle: '刷新成功',\n\t\t\ticon: 'success'\n\t\t})\n\t} catch (e) {\n\t\tuni.__f__('error','at pages/mine/waiting.vue:142','刷新失败：', e)\n\t} finally {\n\t\tuni.stopPullDownRefresh()\n\t}\n})\n\n// 触底加载更多\nonReachBottom(() => {\n\tloadWaitingList()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.tabs{\n\twidth: 100vw;\n\tpadding: 30rpx 30rpx 10rpx 30rpx;\n\tbackground-color: #FFFFFF;\n\tposition: sticky;\n\ttop: var(--window-top);\n\tleft: 0;\n\tz-index: 10;\n\tbox-shadow: 0 10rpx 10rpx #eeeeee;\n\t.tag{\n\t\tborder: 1rpx solid $main-color;\n\t\theight: 68rpx;\n\t\tborder-radius: 10rpx;\n\t\tcolor: $main-color;\n\t\tpadding: 0 20rpx;\n\t}\n}\n.line{\n\twidth: 100%;\n\theight: 1rpx;\n\tbackground-color: #eeeeee;\n}\n.no {\n\twidth: 60rpx;\n\theight: 60rpx;\n\tborder: 1rpx solid $main-color;\n\tcolor: $main-color;\n\tborder-radius: 10rpx;\n\tflex-shrink: 0;\n}\n</style>\n","import MiniProgramPage from '/Users/jcy/code/wx/system/pages/mine/waiting.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uniCloud","uni","onLoad","onPullDownRefresh","onReachBottom"],"mappings":";;;AAoDA,MAAM,WAAW;;;;AAFX,UAAA,cAAcA,kBAAW,CAAA,CAAE;AAC3B,UAAA,OAAOA,kBAAI,CAAC;AAEZ,UAAA,UAAUA,kBAAI,IAAI;AAClB,UAAA,YAAYA,kBAAI,KAAK;AAGrB,UAAA,kBAAkB,OAAO,YAAY,UAAU;AACpD,UAAI,UAAU;AAAO;AACjB,UAAA,CAAC,QAAQ,SAAS,CAAC;AAAW;AAE9B,UAAA;AACH,kBAAU,QAAQ;AAGlB,YAAI,WAAW;AACd,eAAK,QAAQ;AACb,kBAAQ,QAAQ;AAAA,QACjB;AAEM,cAAA,WAAWC,cAAAA,GAAS,aAAa,OAAO;AACxC,cAAA,MAAM,MAAM,SAAS,QAAQ;AAAA,UAClC,QAAQ;AAAA;AAAA,UACR,MAAM,KAAK;AAAA,UACX;AAAA,QAAA,CACA;AAEG,YAAA,IAAI,YAAY,GAAG;AACtB,cAAI,WAAW;AACF,wBAAA,QAAQ,IAAI,KAAK;AAAA,UAAA,OACvB;AACM,wBAAA,QAAQ,CAAC,GAAG,YAAY,OAAO,GAAG,IAAI,KAAK,IAAI;AAAA,UAC5D;AAGA,cAAI,IAAI,KAAK,KAAK,SAAS,UAAU;AACpC,oBAAQ,QAAQ;AAAA,UACjB;AAGA,cAAI,IAAI,KAAK,KAAK,SAAS,GAAG;AACxB,iBAAA;AAAA,UACN;AAAA,QAAA,OACM;AACNC,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI,UAAU;AAAA,YACrB,MAAM;AAAA,UAAA,CACN;AAAA,QACF;AAAA,eACQ,GAAQ;AAChBA,sBAAA,MAAI,MAAM,SAAQ,iCAAgC,SAAS,CAAC;AAC5DA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,EAAE,WAAW;AAAA,UACpB,MAAM;AAAA,QAAA,CACN;AAAA,MAAA,UACA;AACD,kBAAU,QAAQ;AAAA,MACnB;AAAA,IAAA;AAIK,UAAA,aAAa,CAAC,cAAsB;AACnC,YAAA,OAAO,IAAI,KAAK,SAAS;AACzB,YAAA,QAAQ,OAAO,KAAK,SAAA,IAAa,CAAC,EAAE,SAAS,GAAG,GAAG;AACnD,YAAA,MAAM,OAAO,KAAK,QAAS,CAAA,EAAE,SAAS,GAAG,GAAG;AAC5C,YAAA,OAAO,OAAO,KAAK,SAAU,CAAA,EAAE,SAAS,GAAG,GAAG;AAC9C,YAAA,SAAS,OAAO,KAAK,WAAY,CAAA,EAAE,SAAS,GAAG,GAAG;AACxD,aAAO,GAAG,KAAK,IAAI,GAAG,IAAI,IAAI,IAAI,MAAM;AAAA,IAAA;AAInC,UAAA,WAAW,CAAC,SAAc;AAC/BA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,yBAAyB,KAAK,GAAG;AAAA,MAAA,CACtC;AAAA,IAAA;AAIFC,kBAAAA,OAAO,MAAM;AACZ,sBAAgB,IAAI;AAAA,IAAA,CACpB;AAGDC,kBAAAA,kBAAkB,YAAY;AACzB,UAAA;AACH,cAAM,gBAAgB,IAAI;AAC1BF,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,eACO,GAAG;AACXA,sBAAA,MAAI,MAAM,SAAQ,iCAAgC,SAAS,CAAC;AAAA,MAAA,UAC3D;AACDA,sBAAA,MAAI,oBAAoB;AAAA,MACzB;AAAA,IAAA,CACA;AAGDG,kBAAAA,cAAc,MAAM;AACH;IAAA,CAChB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrJD,GAAG,WAAW,eAAe;"}