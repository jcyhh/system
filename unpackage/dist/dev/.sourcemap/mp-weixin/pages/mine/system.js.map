{"version":3,"file":"system.js","sources":["pages/mine/system.vue","pages/mine/system.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"page\">\n\t\t<view class=\"container\">\n\t\t\t<view class=\"card mb30\">\n\t\t\t\t<view class=\"card-header\">\n\t\t\t\t\t<view class=\"title size32 bold\">平台排队开关</view>\n\t\t\t\t\t<view class=\"desc size24 gray mt10\">关闭后用户将无法提交排队申请</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"card-body\">\n\t\t\t\t\t<view class=\"switch-item\">\n\t\t\t\t\t\t<view class=\"switch-info\">\n\t\t\t\t\t\t\t<view class=\"switch-label size30\">排队功能</view>\n\t\t\t\t\t\t\t<view class=\"switch-status size26\" :class=\"queueSwitch ? 'status-on' : 'status-off'\">\n\t\t\t\t\t\t\t\t{{ queueSwitch ? '已开启' : '已关闭' }}\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<switch :checked=\"queueSwitch\" @change=\"onSwitchChange\" :disabled=\"loading\" color=\"#29156a\" />\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"tips\">\n\t\t\t\t<view class=\"tip-item size26 gray\">\n\t\t\t\t\t<text>• 关闭排队功能后，用户无法提交新的排队申请</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tip-item size26 gray\">\n\t\t\t\t\t<text>• 已经在排队中的任务不受影响</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"tip-item size26 gray\">\n\t\t\t\t\t<text>• 建议在系统维护或特殊情况时使用</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref } from 'vue'\nimport { onLoad, onShow } from '@dcloudio/uni-app'\nimport { useAppStore } from '@/store'\n\nconst appStore = useAppStore()\n\nconst queueSwitch = ref(true)\nconst switchId = ref('')\nconst loading = ref(false)\n\n// 加载排队开关状态\nconst loadQueueSwitch = async () => {\n\ttry {\n\t\tconst db = uniCloud.database()\n\t\tconst res = await db.collection('system_info')\n\t\t\t.where({\n\t\t\t\tkey: 'queue_switch'\n\t\t\t})\n\t\t\t.limit(1)\n\t\t\t.get()\n\t\t\n\t\tif (res.result && res.result.data && res.result.data.length > 0) {\n\t\t\tconst data = res.result.data[0]\n\t\t\tswitchId.value = data._id\n\t\t\tqueueSwitch.value = data.content === 'true'\n\t\t} else {\n\t\t\t// 如果没有找到配置，提示添加\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '提示',\n\t\t\t\tcontent: '未找到排队开关配置，请先在数据库中添加 queue_switch 配置',\n\t\t\t\tshowCancel: false\n\t\t\t})\n\t\t}\n\t} catch (e) {\n\t\tuni.__f__('error','at pages/mine/system.vue:72','加载排队开关失败：', e)\n\t\tuni.showToast({\n\t\t\ttitle: '加载失败',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\n\n// 开关变更\nconst onSwitchChange = (e: any) => {\n\tconst newValue = e.detail.value\n\t\n\tuni.showModal({\n\t\ttitle: '确认操作',\n\t\tcontent: `确定要${newValue ? '开启' : '关闭'}排队功能吗？`,\n\t\tsuccess: async (res) => {\n\t\t\tif (res.confirm) {\n\t\t\t\tawait updateQueueSwitch(newValue)\n\t\t\t}\n\t\t}\n\t})\n}\n\n// 更新排队开关\nconst updateQueueSwitch = async (value: boolean) => {\n\tif (!switchId.value) {\n\t\tuni.showToast({\n\t\t\ttitle: '配置ID不存在',\n\t\t\ticon: 'none'\n\t\t})\n\t\treturn\n\t}\n\t\n\tloading.value = true\n\tuni.showLoading({\n\t\ttitle: '保存中...'\n\t})\n\t\n\ttry {\n\t\tconst db = uniCloud.database()\n\t\tawait db.collection('system_info')\n\t\t\t.doc(switchId.value)\n\t\t\t.update({\n\t\t\t\tcontent: value ? 'true' : 'false',\n\t\t\t\tupdate_time: Date.now()\n\t\t\t})\n\t\t\n\t\tqueueSwitch.value = value\n\t\tuni.hideLoading()\n\t\tuni.showToast({\n\t\t\ttitle: value ? '已开启排队' : '已关闭排队',\n\t\t\ticon: 'success'\n\t\t})\n\t} catch (e) {\n\t\tuni.__f__('error','at pages/mine/system.vue:126','更新排队开关失败：', e)\n\t\tuni.hideLoading()\n\t\tuni.showToast({\n\t\t\ttitle: '保存失败',\n\t\t\ticon: 'none'\n\t\t})\n\t} finally {\n\t\tloading.value = false\n\t}\n}\n\n// 检查管理员权限\nconst checkAdmin = () => {\n\tif (appStore.role !== 1) {\n\t\tuni.showModal({\n\t\t\ttitle: '权限不足',\n\t\t\tcontent: '仅管理员可以访问此页面',\n\t\t\tshowCancel: false,\n\t\t\tsuccess: () => {\n\t\t\t\tuni.navigateBack()\n\t\t\t}\n\t\t})\n\t\treturn false\n\t}\n\treturn true\n}\n\nonLoad(() => {\n\tif (checkAdmin()) {\n\t\tloadQueueSwitch()\n\t}\n})\n\nonShow(() => {\n\tif (checkAdmin()) {\n\t\tloadQueueSwitch()\n\t}\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.page {\n\tmin-height: 100vh;\n\tbackground-color: #F5F5F5;\n}\n\n.container {\n\tpadding: 30rpx;\n}\n\n.card {\n\tbackground-color: #FFFFFF;\n\tborder-radius: 20rpx;\n\toverflow: hidden;\n}\n\n.card-header {\n\tpadding: 30rpx;\n\tborder-bottom: 1rpx solid #EEEEEE;\n}\n\n.title {\n\tcolor: #333333;\n}\n\n.desc {\n\tmargin-top: 10rpx;\n}\n\n.card-body {\n\tpadding: 30rpx;\n}\n\n.switch-item {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n}\n\n.switch-info {\n\tflex: 1;\n}\n\n.switch-label {\n\tcolor: #333333;\n\tfont-weight: 500;\n}\n\n.switch-status {\n\tmargin-top: 10rpx;\n\tfont-weight: 500;\n}\n\n.status-on {\n\tcolor: #29156a;\n}\n\n.status-off {\n\tcolor: #999999;\n}\n\n.tips {\n\tpadding: 30rpx 0;\n}\n\n.tip-item {\n\tmargin-bottom: 20rpx;\n\tline-height: 1.6;\n}\n</style>\n","import MiniProgramPage from '/Users/jcy/code/wx/system/pages/mine/system.vue'\nwx.createPage(MiniProgramPage)"],"names":["useAppStore","ref","uniCloud","uni","onLoad","onShow"],"mappings":";;;;;;;AAyCA,UAAM,WAAWA,kBAAAA;AAEX,UAAA,cAAcC,kBAAI,IAAI;AACtB,UAAA,WAAWA,kBAAI,EAAE;AACjB,UAAA,UAAUA,kBAAI,KAAK;AAGzB,UAAM,kBAAkB,YAAY;AAC/B,UAAA;AACG,cAAA,KAAKC,iBAAS;AACpB,cAAM,MAAM,MAAM,GAAG,WAAW,aAAa,EAC3C,MAAM;AAAA,UACN,KAAK;AAAA,QACL,CAAA,EACA,MAAM,CAAC,EACP,IAAI;AAEF,YAAA,IAAI,UAAU,IAAI,OAAO,QAAQ,IAAI,OAAO,KAAK,SAAS,GAAG;AAChE,gBAAM,OAAO,IAAI,OAAO,KAAK,CAAC;AAC9B,mBAAS,QAAQ,KAAK;AACV,sBAAA,QAAQ,KAAK,YAAY;AAAA,QAAA,OAC/B;AAENC,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,SAAS;AAAA,YACT,YAAY;AAAA,UAAA,CACZ;AAAA,QACF;AAAA,eACQ,GAAG;AACXA,sBAAA,MAAI,MAAM,SAAQ,+BAA8B,aAAa,CAAC;AAC9DA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,MACF;AAAA,IAAA;AAIK,UAAA,iBAAiB,CAAC,MAAW;AAC5B,YAAA,WAAW,EAAE,OAAO;AAE1BA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS,MAAM,WAAW,OAAO,IAAI;AAAA,QACrC,SAAS,OAAO,QAAQ;AACvB,cAAI,IAAI,SAAS;AAChB,kBAAM,kBAAkB,QAAQ;AAAA,UACjC;AAAA,QACD;AAAA,MAAA,CACA;AAAA,IAAA;AAII,UAAA,oBAAoB,OAAO,UAAmB;AAC/C,UAAA,CAAC,SAAS,OAAO;AACpBA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AACD;AAAA,MACD;AAEA,cAAQ,QAAQ;AAChBA,oBAAAA,MAAI,YAAY;AAAA,QACf,OAAO;AAAA,MAAA,CACP;AAEG,UAAA;AACG,cAAA,KAAKD,iBAAS;AACd,cAAA,GAAG,WAAW,aAAa,EAC/B,IAAI,SAAS,KAAK,EAClB,OAAO;AAAA,UACP,SAAS,QAAQ,SAAS;AAAA,UAC1B,aAAa,KAAK,IAAI;AAAA,QAAA,CACtB;AAEF,oBAAY,QAAQ;AACpBC,sBAAA,MAAI,YAAY;AAChBA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,QAAQ,UAAU;AAAA,UACzB,MAAM;AAAA,QAAA,CACN;AAAA,eACO,GAAG;AACXA,sBAAA,MAAI,MAAM,SAAQ,gCAA+B,aAAa,CAAC;AAC/DA,sBAAA,MAAI,YAAY;AAChBA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AAAA,MAAA,UACA;AACD,gBAAQ,QAAQ;AAAA,MACjB;AAAA,IAAA;AAID,UAAM,aAAa,MAAM;AACpB,UAAA,SAAS,SAAS,GAAG;AACxBA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,SAAS;AAAA,UACT,YAAY;AAAA,UACZ,SAAS,MAAM;AACdA,0BAAA,MAAI,aAAa;AAAA,UAClB;AAAA,QAAA,CACA;AACM,eAAA;AAAA,MACR;AACO,aAAA;AAAA,IAAA;AAGRC,kBAAAA,OAAO,MAAM;AACZ,UAAI,cAAc;AACD;MACjB;AAAA,IAAA,CACA;AAEDC,kBAAAA,OAAO,MAAM;AACZ,UAAI,cAAc;AACD;MACjB;AAAA,IAAA,CACA;;;;;;;;;;;;;ACjKD,GAAG,WAAW,eAAe;"}