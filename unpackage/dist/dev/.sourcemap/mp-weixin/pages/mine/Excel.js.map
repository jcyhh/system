{"version":3,"file":"Excel.js","sources":["pages/mine/Excel.vue","/Users/jcy/code/wx/system/pages/mine/Excel.vue?type=component"],"sourcesContent":["<template>\n\t<uni-popup ref=\"popupRef\" type=\"center\">\n\t\t<view class=\"pop\">\n\t\t\t<view class=\"flex jb ac mb40\">\n\t\t\t\t<uni-icons type=\"closeempty\" color=\"#FFFFFF\" :size=\"25\"></uni-icons>\n\t\t\t\t<view class=\"size30 bold\">导出数据</view>\n\t\t\t\t<uni-icons type=\"closeempty\" :size=\"25\" @click=\"popupRef?.close()\"></uni-icons>\n\t\t\t</view>\n\t\t\t<view class=\"flex jb ac\">\n\t\t\t\t<view class=\"flex1\">\n\t\t\t\t\t<picker mode=\"date\" :value=\"startTime\" @change=\"startChange\">\n\t\t\t\t\t\t<view class=\"box flex jc ac size28\">\n\t\t\t\t\t\t\t<view v-if=\"startTime\">{{ startTime }}</view>\n\t\t\t\t\t\t\t<view class=\"grey\" v-else>开始日期</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</picker>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"ml20 mr20 size28\">~</view>\n\t\t\t\t<view class=\"flex1\">\n\t\t\t\t\t<picker mode=\"date\" :value=\"endTime\" @change=\"endChange\">\n\t\t\t\t\t\t<view class=\"box flex jc ac size28\">\n\t\t\t\t\t\t\t<view v-if=\"endTime\">{{ endTime }}</view>\n\t\t\t\t\t\t\t<view class=\"grey\" v-else>结束日期</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</picker>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"size28 grey mt30\">导出数据为开始日期的08:00 ～ 结束日期的08:00</view>\n\t\t\t\n\t\t\t<view class=\"flex mt30\">\n\t\t\t\t<view class=\"cancel flex1 flex jc ac\" @click=\"reset\">取消</view>\n\t\t\t\t<view class=\"submit flex1 flex jc ac ml30\" @click=\"submit\">导出</view>\n\t\t\t</view>\n\t\t</view>\n\t</uni-popup>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref } from 'vue';\n\nconst emits = defineEmits(['submit'])\n\nconst popupRef = ref()\n\nconst startTime = ref()\nconst startChange = (e:any) => startTime.value = e.detail.value\n\nconst endTime = ref()\nconst endChange = (e:any) => endTime.value = e.detail.value\n\nconst open = () => popupRef.value?.open()\n\nconst reset = () => {\n\tpopupRef.value?.close()\n}\n\nconst submit = async () => {\n\tif (!startTime.value || !endTime.value) {\n\t\tuni.showToast({\n\t\t\ttitle: '请选择完整的时间区间',\n\t\t\ticon: 'none'\n\t\t})\n\t\treturn\n\t}\n\t\n\t// 检查时间顺序\n\tif (new Date(startTime.value) > new Date(endTime.value)) {\n\t\tuni.showToast({\n\t\t\ttitle: '开始日期不能晚于结束日期',\n\t\t\ticon: 'none'\n\t\t})\n\t\treturn\n\t}\n\t\n\ttry {\n\t\tuni.showLoading({ title: '导出中...' })\n\t\t\n\t\t// 计算时间戳（开始日期08:00 到 结束日期08:00）\n\t\t// 使用iOS兼容的日期格式\n\t\tconst start_time = new Date(startTime.value.replace(/-/g, '/') + ' 08:00:00').getTime()\n\t\tconst end_time = new Date(endTime.value.replace(/-/g, '/') + ' 08:00:00').getTime()\n\t\t\n\t\t// 调用云函数导出Excel\n\t\tconst truckObj = uniCloud.importObject('truck')\n\t\tconst res = await truckObj.exportExcel({\n\t\t\tstart_time,\n\t\t\tend_time\n\t\t})\n\t\t\n\t\tuni.hideLoading()\n\t\t\n\t\tif (res.errCode === 0) {\n\t\t\t// 下载临时文件\n\t\t\tconst downloadRes = await uni.downloadFile({\n\t\t\t\turl: res.data.fileUrl\n\t\t\t})\n\t\t\t\n\t\t\tif (downloadRes.statusCode === 200) {\n\t\t\t\t// 分享文件到微信\n\n\t\t\t\tuni.shareFileMessage({\n\t\t\t\t\tfilePath: downloadRes.tempFilePath,\n\t\t\t\t\tfileName: res.data.fileName || `已完成单子_${startTime.value}_${endTime.value}.xlsx`,\n\t\t\t\t\tsuccess: () => {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '分享成功',\n\t\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t\t})\n\t\t\t\t\t\tpopupRef.value?.close()\n\t\t\t\t\t},\n\t\t\t\t\tfail: (err: any) => {\n\t\t\t\t\t\tuni.__f__('error','at pages/mine/Excel.vue:112','分享失败：', err)\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '分享失败',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\t\n\n\n\n\n\n\n\t\t\t} else {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '文件下载失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t}\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: res.errMsg || '导出失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t} catch (e: any) {\n\t\tuni.hideLoading()\n\t\tuni.__f__('error','at pages/mine/Excel.vue:141','导出失败：', e)\n\t\tuni.showToast({\n\t\t\ttitle: e.message || '导出失败',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\n\ndefineExpose({\n\topen\n})\n</script>\n\n<style lang=\"scss\" scoped>\n\t.pop{\n\t\twidth: 680rpx;\n\t\tborder-radius: 30rpx;\n\t\tpadding: 30rpx;\n\t\tbackground-color: #FFFFFF;\n\t\t.cancel{\n\t\t\theight: 88rpx;\n\t\t\tborder-radius: 20rpx;\n\t\t\tbackground-color: #eeeeee;\n\t\t}\n\t\t.submit{\n\t\t\theight: 88rpx;\n\t\t\tborder-radius: 20rpx;\n\t\t\tbackground-color: $main-color;\n\t\t\tcolor: #FFFFFF;\n\t\t}\n\t}\n</style>\n","import Component from '/Users/jcy/code/wx/system/pages/mine/Excel.vue'\nwx.createComponent(Component)"],"names":["ref","uni","uniCloud"],"mappings":";;;;;;;;;;;;;;;;AA0CA,UAAM,WAAWA,cAAAA;AAEjB,UAAM,YAAYA,cAAAA;AAClB,UAAM,cAAc,CAAC,MAAU,UAAU,QAAQ,EAAE,OAAO;AAE1D,UAAM,UAAUA,cAAAA;AAChB,UAAM,YAAY,CAAC,MAAU,QAAQ,QAAQ,EAAE,OAAO;AAEtD,UAAM,OAAO,MAAM;;AAAA,4BAAS,UAAT,mBAAgB;AAAA;AAEnC,UAAM,QAAQ,MAAM;;AACnB,qBAAS,UAAT,mBAAgB;AAAA,IAAM;AAGvB,UAAM,SAAS,YAAY;AAC1B,UAAI,CAAC,UAAU,SAAS,CAAC,QAAQ,OAAO;AACvCC,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AACD;AAAA,MACD;AAGI,UAAA,IAAI,KAAK,UAAU,KAAK,IAAI,IAAI,KAAK,QAAQ,KAAK,GAAG;AACxDA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QAAA,CACN;AACD;AAAA,MACD;AAEI,UAAA;AACHA,sBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AAI7B,cAAA,cAAiB,oBAAA,KAAK,UAAU,MAAM,QAAQ,MAAM,GAAG,IAAI,WAAW,GAAE,QAAQ;AAChF,cAAA,YAAe,oBAAA,KAAK,QAAQ,MAAM,QAAQ,MAAM,GAAG,IAAI,WAAW,GAAE,QAAQ;AAG5E,cAAA,WAAWC,cAAAA,GAAS,aAAa,OAAO;AACxC,cAAA,MAAM,MAAM,SAAS,YAAY;AAAA,UACtC;AAAA,UACA;AAAA,QAAA,CACA;AAEDD,sBAAA,MAAI,YAAY;AAEZ,YAAA,IAAI,YAAY,GAAG;AAEhB,gBAAA,cAAc,MAAMA,cAAA,MAAI,aAAa;AAAA,YAC1C,KAAK,IAAI,KAAK;AAAA,UAAA,CACd;AAEG,cAAA,YAAY,eAAe,KAAK;AAGnCA,0BAAAA,MAAI,iBAAiB;AAAA,cACpB,UAAU,YAAY;AAAA,cACtB,UAAU,IAAI,KAAK,YAAY,SAAS,UAAU,KAAK,IAAI,QAAQ,KAAK;AAAA,cACxE,SAAS,MAAM;;AACdA,8BAAAA,MAAI,UAAU;AAAA,kBACb,OAAO;AAAA,kBACP,MAAM;AAAA,gBAAA,CACN;AACD,+BAAS,UAAT,mBAAgB;AAAA,cACjB;AAAA,cACA,MAAM,CAAC,QAAa;AACnBA,8BAAA,MAAI,MAAM,SAAQ,+BAA8B,SAAS,GAAG;AAC5DA,8BAAAA,MAAI,UAAU;AAAA,kBACb,OAAO;AAAA,kBACP,MAAM;AAAA,gBAAA,CACN;AAAA,cACF;AAAA,YAAA,CACA;AAAA,UAAA,OASK;AACNA,0BAAAA,MAAI,UAAU;AAAA,cACb,OAAO;AAAA,cACP,MAAM;AAAA,YAAA,CACN;AAAA,UACF;AAAA,QAAA,OACM;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI,UAAU;AAAA,YACrB,MAAM;AAAA,UAAA,CACN;AAAA,QACF;AAAA,eACQ,GAAQ;AAChBA,sBAAA,MAAI,YAAY;AAChBA,sBAAA,MAAI,MAAM,SAAQ,+BAA8B,SAAS,CAAC;AAC1DA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,EAAE,WAAW;AAAA,UACpB,MAAM;AAAA,QAAA,CACN;AAAA,MACF;AAAA,IAAA;AAGY,aAAA;AAAA,MACZ;AAAA,IAAA,CACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrJD,GAAG,gBAAgB,SAAS;"}