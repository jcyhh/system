{"version":3,"file":"dealing.js","sources":["pages/mine/dealing.vue","pages/mine/dealing.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"pl30 pr30 pt30\">\n\t\t\n\t\t<view class=\"flex jc pt60\" v-if=\"!dealingData\">\n\t\t\t<image src=\"@/static/imgs/nodata.png\" class=\"img200\"></image>\n\t\t</view>\n\t\t<view class=\"tc size26 gray mt30\" v-if=\"!dealingData\">当前没有在处理中的记录～</view>\n\t\t\n\t\t<template v-if=\"dealingData\">\n\t\t\t<view class=\"card\">\n\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t<view class=\"line mr20\"></view>\n\t\t\t\t\t<view class=\"size30 bold\">用户信息</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"mt40 flex ac size28\">\n\t\t\t\t\t<view class=\"grey\">姓名：</view>\n\t\t\t\t\t<view class=\"flex ac\" @click=\"copy(dealingData.driver_name)\">\n\t\t\t\t\t\t<view>{{ dealingData.driver_name }}</view>\n\t\t\t\t\t\t<image src=\"@/static/imgs/copy.png\" class=\"img38 ml10\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"mt30 flex ac size28\">\n\t\t\t\t\t<view class=\"grey\">电话：</view>\n\t\t\t\t\t<view class=\"flex ac\" @click=\"copy(dealingData.phone)\">\n\t\t\t\t\t\t<view>{{ dealingData.phone }}</view>\n\t\t\t\t\t\t<image src=\"@/static/imgs/copy.png\" class=\"img38 ml10\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"mt30 flex ac size28\">\n\t\t\t\t\t<view class=\"grey\">装卸车：</view>\n\t\t\t\t\t<view class=\"flex ac\" v-if=\"dealingData.operation_type === 0\">\n\t\t\t\t\t\t<view>装车</view>\n\t\t\t\t\t\t<image src=\"/static/imgs/6.png\" class=\"img48 ml10\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"flex ac\" v-else>\n\t\t\t\t\t\t<view>卸车</view>\n\t\t\t\t\t\t<image src=\"/static/imgs/5.png\" class=\"img48 ml10\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"card mt30\" v-if=\"dealingData.operation_type === 1 && dealingData.loading_province\" @click=\"copy(dealingData.loading_province + dealingData.loading_address)\">\n\t\t\t\t<view class=\"flex jb ac\">\n\t\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t\t<view class=\"line mr20\"></view>\n\t\t\t\t\t\t<view class=\"size30 bold\">装车地点</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<image src=\"/static/imgs/copy.png\" class=\"img38\"></image>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<view class=\"flex ac mt40\">\n\t\t\t\t\t<uni-icons type=\"location-filled\" :size=\"40\"></uni-icons>\n\t\t\t\t\t<view class=\"ml20\">\n\t\t\t\t\t\t<view class=\"size30\">{{ dealingData.loading_province }}</view>\n\t\t\t\t\t\t<view class=\"size26 mt10 grey\">{{ dealingData.loading_address }}</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"card mt30\">\n\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t<view class=\"line mr20\"></view>\n\t\t\t\t\t<view class=\"size30 bold\">车辆信息</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"mt40 flex ac size28\">\n\t\t\t\t\t<view class=\"grey\">车牌号：</view>\n\t\t\t\t\t<view class=\"flex ac\" @click=\"copy(dealingData.plate_number)\">\n\t\t\t\t\t\t<view>{{ dealingData.plate_number }}</view>\n\t\t\t\t\t\t<image src=\"@/static/imgs/copy.png\" class=\"img38 ml10\"></image>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"mt30 flex ac size28\">\n\t\t\t\t\t<view class=\"grey\">车型：</view>\n\t\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t\t<view>{{ dealingData.truck_type }}</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"mt30 flex ac size28\">\n\t\t\t\t\t<view class=\"grey\">到达时间：</view>\n\t\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t\t<view>{{ formatTime(dealingData.create_time) }}</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"mt30 flex ac size28\" v-if=\"dealingData.complete_time\">\n\t\t\t\t\t<view class=\"grey\">完成时间：</view>\n\t\t\t\t\t<view class=\"flex ac\">\n\t\t\t\t\t\t<view>{{ formatTime(dealingData.complete_time) }}</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"flex mt40\">\n\t\t\t\t\t<view class=\"flex col jc ac flex1\" @click=\"viewImg(dealingData.photo)\">\n\t\t\t\t\t\t<image :src=\"dealingData.photo\" mode=\"aspectFill\" class=\"cover\"></image>\n\t\t\t\t\t\t<view class=\"size24 gray mt10\">到达照片</view>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"flex col jc ac flex1\" @click=\"viewImg(dealingData.complete_photo)\" v-if=\"dealingData.complete_photo\">\n\t\t\t\t\t\t<image :src=\"dealingData.complete_photo\" mode=\"aspectFill\" class=\"cover\"></image>\n\t\t\t\t\t\t<view class=\"size24 gray mt10\">完成照片</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"mt100 btn flex jc ac\" @click=\"submit\">确认完成</view>\n\t\t\t\n\t\t\t<view class=\"safeBottom\"></view>\n\t\t</template>\n\t\t\n\t</view>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref } from 'vue';\nimport { onLoad, onPullDownRefresh } from '@dcloudio/uni-app';\nimport { useAppStore } from '@/store/modules/app';\n\nconst appStore = useAppStore();\nconst dealingData = ref<any>(null)\n\n// 加载处理中的单子\nconst loadDealingData = async () => {\n\ttry {\n\t\tconst truckObj = uniCloud.importObject('truck')\n\t\tconst res = await truckObj.getList({\n\t\t\tstatus: 1,  // 处理中\n\t\t\tpage: 1,\n\t\t\tpageSize: 1\n\t\t})\n\t\t\n\t\tif (res.errCode === 0) {\n\t\t\tif (res.data.list.length > 0) {\n\t\t\t\tdealingData.value = res.data.list[0]\n\t\t\t} else {\n\t\t\t\tdealingData.value = null\n\t\t\t}\n\t\t} else {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: res.errMsg || '获取失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t} catch (e: any) {\n\t\tuni.__f__('error','at pages/mine/dealing.vue:141','获取失败：', e)\n\t\tuni.showToast({\n\t\t\ttitle: e.message || '获取失败',\n\t\t\ticon: 'none'\n\t\t})\n\t}\n}\n\n// 格式化时间\nconst formatTime = (timestamp: number) => {\n\tconst date = new Date(timestamp)\n\tconst year = date.getFullYear()\n\tconst month = String(date.getMonth() + 1).padStart(2, '0')\n\tconst day = String(date.getDate()).padStart(2, '0')\n\tconst hour = String(date.getHours()).padStart(2, '0')\n\tconst minute = String(date.getMinutes()).padStart(2, '0')\n\tconst second = String(date.getSeconds()).padStart(2, '0')\n\treturn `${year}-${month}-${day} ${hour}:${minute}:${second}`\n}\n\n// 查看图片\nconst viewImg = (url: string) => {\n\tif (!url) return\n\tuni.previewImage({\n\t\turls: [url]\n\t})\n}\n\n// 复制文本\nconst copy = (text: string) => {\n\tuni.setClipboardData({\n\t\tdata: text\n\t})\n}\n\n// 确认完成\nconst submit = async () => {\n\tif (!dealingData.value) return\n\t\n\t// 打印调试信息\n\tuni.__f__('log','at pages/mine/dealing.vue:181','当前用户角色:', appStore.role)\n\tuni.__f__('log','at pages/mine/dealing.vue:182','是否管理员:', appStore.role === 1)\n\t\n\t// 管理员：直接确认完成，不需要上传图片\n\tif (appStore.role === 1) {\n\t\tuni.showModal({\n\t\t\ttitle: '确认完成',\n\t\t\tcontent: '确定要完成该订单吗？',\n\t\t\tsuccess: async (res) => {\n\t\t\t\tif (res.confirm) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tuni.showLoading({ title: '处理中...' })\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst truckObj = uniCloud.importObject('truck')\n\t\t\t\t\t\tconst result = await truckObj.adminComplete({\n\t\t\t\t\t\t\tid: dealingData.value._id\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (result.errCode === 0) {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: '操作成功',\n\t\t\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// 延迟返回上一页\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tuni.navigateBack()\n\t\t\t\t\t\t\t}, 1500)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\ttitle: result.errMsg || '操作失败',\n\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e: any) {\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\tuni.__f__('error','at pages/mine/dealing.vue:219','操作失败：', e)\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: e.message || '操作失败',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} \n\t// 普通用户：跳转到完成页面上传图片\n\telse {\n\t\tuni.navigateTo({\n\t\t\turl: `/pages/home/Finish?id=${dealingData.value._id}`\n\t\t})\n\t}\n}\n\n// 页面加载\nonLoad(() => {\n\tloadDealingData()\n})\n\n// 下拉刷新\nonPullDownRefresh(async () => {\n\ttry {\n\t\tawait loadDealingData()\n\t\tuni.showToast({\n\t\t\ttitle: '刷新成功',\n\t\t\ticon: 'success'\n\t\t})\n\t} catch (e) {\n\t\tuni.__f__('error','at pages/mine/dealing.vue:251','刷新失败：', e)\n\t} finally {\n\t\tuni.stopPullDownRefresh()\n\t}\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.line{\n\twidth: 8rpx;\n\theight: 30rpx;\n\tborder-radius: 4rpx;\n\tbackground-color: $main-color;\n}\n.cover{\n\twidth: 200rpx;\n\theight: 200rpx;\n\tborder-radius: 20rpx;\n}\n.btn{\n\theight: 88rpx;\n\tborder-radius: 44rpx;\n\tbackground-color: $main-color;\n\tcolor: #FFFFFF;\n}\n</style>\n","import MiniProgramPage from '/Users/jcy/code/wx/system/pages/mine/dealing.vue'\nwx.createPage(MiniProgramPage)"],"names":["useAppStore","ref","uniCloud","uni","onLoad","onPullDownRefresh"],"mappings":"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"}