{"version":3,"file":"Finish.js","sources":["pages/home/Finish.vue","/Users/jcy/code/wx/system/pages/home/Finish.vue?type=component"],"sourcesContent":["<template>\n\t<uni-popup ref=\"popupRef\" type=\"center\" :mask-click=\"false\">\n\t\t<view class=\"pop\">\n\t\t\t<view class=\"flex jb ac\">\n\t\t\t\t<uni-icons type=\"closeempty\" color=\"#FFFFFF\" :size=\"25\"></uni-icons>\n\t\t\t\t<view class=\"size30 bold\">装卸完成</view>\n\t\t\t\t<uni-icons type=\"closeempty\" :size=\"25\" @click=\"close()\"></uni-icons>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"mt60\">\n\t\t\t\t<view class=\"tc size26 gray mb20\">请上传装卸完成照片</view>\n\t\t\t\t\n\t\t\t\t<view class=\"flex jc\">\n\t\t\t\t\t<view class=\"upload flex jc ac\" @click=\"chooseImage\" v-if=\"!photoUrl\">\n\t\t\t\t\t<uni-icons type=\"plusempty\" :size=\"50\" color=\"#999999\"></uni-icons>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"upload rel\" v-else>\n\t\t\t\t\t\t<image :src=\"photoUrl\" mode=\"aspectFill\" class=\"upload-img\"></image>\n\t\t\t\t\t\t<view class=\"del-btn\" @click.stop=\"deleteImage\">\n\t\t\t\t\t\t\t<uni-icons type=\"closeempty\" :size=\"20\" color=\"#FFFFFF\"></uni-icons>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<view class=\"mt50 btn flex jc ac\" @click=\"submit\" :class=\"{ disabled: !photoUrl }\">\n\t\t\t\t确认完成\n\t\t\t</view>\n\t\t</view>\n\t</uni-popup>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref } from 'vue';\n\nconst popupRef = ref()\nconst photoUrl = ref('')\nconst taskId = ref('')\n\nconst open = (id?: string) => {\n\ttaskId.value = id || ''\n\tphotoUrl.value = ''\n\tpopupRef.value?.open()\n}\n\nconst close = () => {\n\tpopupRef.value?.close()\n\tphotoUrl.value = ''\n\ttaskId.value = ''\n}\n\n// 选择图片\nconst chooseImage = () => {\n\tuni.chooseImage({\n\t\tcount: 1,\n\t\tsizeType: ['compressed'],\n\t\tsourceType: ['album', 'camera'],\n\t\tsuccess: async (res) => {\n\t\t\tconst tempFilePath = res.tempFilePaths[0]\n\t\t\t\n\t\t\tuni.showLoading({\n\t\t\t\ttitle: '上传中...'\n\t\t\t})\n\t\t\t\n\t\t\ttry {\n\t\t\t\t// 上传到云存储\n\t\t\t\tconst uploadRes = await uniCloud.uploadFile({\n\t\t\t\t\tfilePath: tempFilePath,\n\t\t\t\t\tcloudPath: `trucks/complete_${Date.now()}_${Math.random().toString(36).slice(2)}.jpg`\n\t\t\t\t})\n\t\t\t\t\n\t\t\t\tphotoUrl.value = uploadRes.fileID\n\t\t\t\tuni.hideLoading()\n\t\t\t\t\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '上传成功',\n\t\t\t\t\ticon: 'success'\n\t\t\t\t})\n\t\t\t} catch (e) {\n\t\t\t\tuni.hideLoading()\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '上传失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t})\n\t\t\t\tuni.__f__('error','at pages/home/Finish.vue:85','上传失败：', e)\n\t\t\t}\n\t\t}\n\t})\n}\n\n// 删除图片\nconst deleteImage = () => {\n\tphotoUrl.value = ''\n}\n\n// 提交完成\nconst submit = async () => {\n\tif (!photoUrl.value) {\n\t\tuni.showToast({\n\t\t\ttitle: '请先上传照片',\n\t\t\ticon: 'none'\n\t\t})\n\t\treturn\n\t}\n\t\n\tif (!taskId.value) {\n\t\tuni.showToast({\n\t\t\ttitle: '任务ID不存在',\n\t\t\ticon: 'none'\n\t\t})\n\t\treturn\n\t}\n\t\n\tuni.showLoading({\n\t\ttitle: '提交中...'\n\t})\n\t\n\ttry {\n\t\tconst truckObj = uniCloud.importObject('truck')\n\t\tconst res = await truckObj.complete({\n\t\t\tid: taskId.value,\n\t\t\tcomplete_photo: photoUrl.value\n\t\t})\n\t\t\n\t\tuni.hideLoading()\n\t\t\n\t\tif (res.errCode === 0) {\n\t\t\tuni.showToast({\n\t\t\t\ttitle: '操作成功',\n\t\t\t\ticon: 'success'\n\t\t\t})\n\t\t\t\n\t\t\t// 关闭弹窗\n\t\t\tclose()\n\t\t\t\n\t\t\t// 通知首页刷新\n\t\t\tuni.$emit('refreshHome')\n\t\t} else {\n\tuni.showToast({\n\t\t\t\ttitle: res.errMsg || '操作失败',\n\t\t\t\ticon: 'none'\n\t\t\t})\n\t\t}\n\t} catch (e: any) {\n\t\tuni.hideLoading()\n\t\tuni.showToast({\n\t\t\ttitle: e.message || '提交失败',\n\t\t\ticon: 'none'\n\t\t})\n\t\tuni.__f__('error','at pages/home/Finish.vue:150','提交失败：', e)\n\t}\n}\n\ndefineExpose({\n\topen,\n\tclose\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.pop{\n\twidth: 600rpx;\n\tborder-radius: 30rpx;\n\tpadding: 30rpx;\n\tbackground-color: #FFFFFF;\n}\n\t.upload{\n\t\twidth: 400rpx;\n\t\theight: 400rpx;\n\t\tborder-radius: 20px;\n\tbackground-color: #F7F7F7;\n\toverflow: hidden;\n}\n.upload-img{\n\twidth: 100%;\n\theight: 100%;\n}\n.del-btn{\n\tposition: absolute;\n\tright: 20rpx;\n\ttop: 20rpx;\n\twidth: 60rpx;\n\theight: 60rpx;\n\tborder-radius: 50%;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\t}\n\t.btn{\n\t\theight: 88rpx;\n\t\tborder-radius: 44rpx;\n\t\tbackground-color: $main-color;\n\t\tcolor: #FFFFFF;\n\tmargin-top: 30rpx;\n\t}\n.btn.disabled{\n\tbackground-color: #CCCCCC;\n}\n</style>\n","import Component from '/Users/jcy/code/wx/system/pages/home/Finish.vue'\nwx.createComponent(Component)"],"names":["ref","uni","uniCloud"],"mappings":"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"}